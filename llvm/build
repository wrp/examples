
Common cmake options:

git clone https://github.com/llvm/llvm-project.git

cmake -S llvm-project/llvm -B ${builddir?} -G Ninja \
	-DCMAKE_BUILD_TYPE=Release \
	-DCMAKE_INSTALL_PREFIX=${prefix?} \
	-DLLVM_ENABLE_PROJECTS="clang;lld;clang-tools-extra;compiler-rt;libcxx;libcxxabi;lldb"
cmake --build ${builddir?} --target install

# use explicitly when building
export CC=${prefix}/bin/clang
export CXX=${prefix}/bin/clang++


To ensure that we can build Python, we also need compiler-rt runtime
When building that, I ran into error related to isinf, etc. getting pulled in
from a math.h from somehwere, so configured using the following:

PREFIX="$HOME"/x86_64/Darwin;
CC=$PREFIX/bin/clang \
CXX=$PREFIX/bin/clang++ \
CPATH="$PREFIX/include" \
CPPFLAGS="-I$PREFIX/include" \
CFLAGS="-I$PREFIX/include" \
LIBRARY_PATH="$PREFIX/lib" \
LDFLAGS="-L$PREFIX/lib -Wl,-rpath,$PREFIX/lib" \
PKG_CONFIG_PATH="$PREFIX/lib/pkgconfig:$PREFIX/share/pkgconfig" \
DYLD_FALLBACK_LIBRARY_PATH="$PREFIX/lib" \
cmake -B build-21.1.0 \
	-G Ninja \
	$HOME/github/llvm/llvm-project/llvm \
	-DCMAKE_INSTALL_PREFIX:PATH=/Users/wrp/x86_64/Darwin/ \
	-DCMAKE_BUILD_TYPE=Release \
	-DLLVM_ENABLE_PROJECTS='clang;lld;clang-tools-extra;lldb' \
	-DLLDB_USE_SYSTEM_DEBUGSERVER=ON \
	-DLLVM_ENABLE_RUNTIMES='compiler-rt;libcxx;libcxxabi;libunwind' \
	-DCMAKE_CXX_FLAGS='-Uisnan -Uisinf -Usignbit -Ufpclassify -Uisfinite -Uisnormal -Uisgreater -Uisgreaterequal -Uisless -Uislessequal -Uislessgreater' \
	-DCOMPILER_RT_BUILD_PROFILE=ON \
	-DCMAKE_OSX_SYSROOT=/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk


Here is what brew does: (see 01.cmake.log for details)

==> Installing node dependency: llvm
==> Patching
==> Applying 1381ad497b9a6d3da630cbef53cbfa9ddf117bb6...40a8c7c0ff3f688b690e4c74db734de67f0f89e9.diff
==> cmake -G Ninja .. -DLLVM_ENABLE_PROJECTS=clang;clang-tools-extra;mlir;polly;lldb -DLLVM_ENABLE_RUNTIMES=compiler-rt;libcxx;libcxxabi;libunwind;openmp -DLLVM_POLLY_LINK_INTO_T
==> cmake --build .
