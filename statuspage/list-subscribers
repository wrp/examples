#!/bin/sh

# Get all subscribers (handle pagination)

page=0

while curl -Ssf -X GET \
	-H "Authorization:OAuth $STATUSPAGE_KEY" \
	"https://api.statuspage.io/v1/pages/${1-$STATUSPAGE_PAGE}/subscribers"$( :
	)"?page=$page" \
| jq -r '.[].email' | grep .
do
	: $(( page += 1 ))
	sleep 1  # status page only allow 1 query per second
done
