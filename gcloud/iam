# Get list of service accounts
gcloud iam service-accounts list

#roles role owner   Show all owners of a project
gcloud projects --format=json get-iam-policy ${PROJECT?} \
| jq '.bindings[]|select(.role == "roles/owner")|.members'

# Get current policy
gcloud projects --format=json get-iam-policy ${PROJECT?} > ${PROJECT}.iam

# Set policy  (give service account access)
gcloud projects set-iam-policy ${PROJECT:?} $PROJECT.iam

# Change acl on a gcs bucket
gsutil acl get gs://${bucket} > ${bucket}.acl
vi ${bucket}.acl
gsutil acl set ${bucket}.acl gs://${bucket}

# Get all roles for a given user (or service account)
gcloud projects --format=json get-iam-policy ${PROJECT?} |
jq -rc ".bindings[] | select( .members[] | test(\"${user?}\")) | \"\t\" + .role"


# Big-query
# To change iam for a bq dataset, use 'bq set-iam-policy' and 'bq get-iam-policy'
# But....that only works if you have whitelisted the project for alpha.
# Otherwise, just ust 'gcloud projects get-iam-policy'
# or:
bq show --format=prettyjson ${PROJECT?}:$dataset > ${dataset?}.json
${EDITOR-vi} ${dataset?}.json
bq update --source ${dataset?}.json ${PROJECT?}:$dataset
