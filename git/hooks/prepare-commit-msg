#!/bin/sh

# Make .git/hooks/prepare-commit-msg a symbolic link to this.
# It will auto inject a trailer based on the directory name.

if ! git interpret-trailers --parse "$1" | grep -q "^type:"; then

	echo >> "$1"
	git diff-index --cached --name-status HEAD -- |
	awk 'NR==1{
		path = $2;
		i = index(path, "/");
		tag = i ? substr(path, 0, i - 1) : path;
		printf "Type: %s\n", tag;
	}' >> "$1"
fi
